# Shadow Chat 功能使用指南

## 🎯 新增功能

### 1️⃣ 消息懒加载（分页加载）

**功能说明**：
- 首次打开加载最新的 150 条消息
- 滚动到顶部会显示"📜 加载更多 (150条)"按钮
- 点击按钮加载更早的 150 条消息
- 加载历史消息时会保持当前滚动位置

**使用方法**：
1. 打开聊天界面，默认显示最新 150 条
2. 向上滚动到顶部
3. 点击"📜 加载更多 (150条)"按钮
4. 继续查看更早的消息

---

### 2️⃣ 图片模糊显示 + 点击预览

**功能说明**：
- 图片在聊天界面中显示为 150x150 的固定大小缩略图
- 缩略图默认模糊处理（避免不宜内容直接展示）
- 鼠标悬停时模糊度减轻
- 点击图片打开全屏预览
- 预览状态下点击任意处或关闭按钮退出

**使用方法**：
1. 聊天中的图片显示为模糊的小图
2. 鼠标悬停可以稍微看清一些
3. 点击图片打开大图预览
4. 点击图片外侧区域或右上角 ✕ 关闭预览

**效果**：
- 缩略图：150x150，模糊 8px
- 悬停时：模糊 4px
- 大图预览：最大 90vh 高度，清晰显示

---

### 3️⃣ @用户功能

**功能说明**：
- 点击消息中的用户昵称可以快速 @该用户
- @用户的文本会在消息中高亮显示
- 支持在消息中手动输入 @用户名

**使用方法**：

**方式 1：点击昵称**
1. 在聊天消息中点击其他用户的昵称
2. 输入框自动插入 `@用户名 `
3. 继续输入消息内容
4. 发送消息

**方式 2：手动输入**
1. 在输入框中输入 `@` 符号
2. 输入用户昵称
3. 空格后继续输入消息
4. 发送消息

**显示效果**：
- @用户名 会以蓝色高亮显示
- 在蓝色消息气泡中显示为白色高亮

---

## 📝 技术细节

### 消息加载逻辑

```javascript
// 初始加载：最新 150 条
loadRecentMessages() → 150 条

// 懒加载：更早的 150 条
loadOlderMessages(beforeTimestamp) → 150 条
```

### 图片处理

```css
/* 缩略图 */
.image-thumbnail {
  width: 150px;
  height: 150px;
  filter: blur(8px);      /* 默认模糊 */
  opacity: 0.7;
}

/* 悬停状态 */
.image-thumbnail:hover {
  filter: blur(4px);      /* 减轻模糊 */
  opacity: 0.9;
}
```

### @用户高亮

```javascript
// 渲染消息时自动识别 @用户
renderMessage(content) {
  return content.replace(/@(\S+)/g, '<span class="mention">@$1</span>')
}
```

---

## 🎨 界面变化

### 聊天窗口顶部
```
┌────────────────────────────┐
│  📜 加载更多 (150条)        │  ← 新增按钮
├────────────────────────────┤
│  用户1: 你好                │
│  用户2: @用户1 Hi!          │  ← @用户高亮
│  [模糊图片 150x150]         │  ← 图片模糊显示
└────────────────────────────┘
```

### 图片预览
```
┌─────────────────────────────────┐
│ 全屏黑色背景                     │
│                                 │
│     ┌───────────┐         ✕    │
│     │           │              │
│     │  清晰大图  │              │
│     │           │              │
│     └───────────┘              │
│                                 │
└─────────────────────────────────┘
```

---

## 🚀 快速开始

### 本地开发
```bash
npm run dev
```

### 生产构建
```bash
npm run build
```

### 测试功能
1. 发送几条消息
2. 上传图片（测试模糊显示）
3. 点击用户名（测试 @功能）
4. 滚动到顶部（测试懒加载）

---

## 🔧 配置参数

可以在代码中调整以下参数：

### 加载数量
```javascript
// src/services/chatService.js
.limit(150)  // 修改为其他数字
```

### 图片大小和模糊度
```css
/* src/components/MessageItem.vue */
.image-thumbnail {
  width: 150px;      /* 缩略图宽度 */
  height: 150px;     /* 缩略图高度 */
  filter: blur(8px); /* 模糊程度 */
}
```

### @用户高亮颜色
```css
/* src/components/MessageItem.vue */
.mention {
  color: #1890ff;    /* 高亮颜色 */
  background: rgba(24, 144, 255, 0.1);  /* 背景色 */
}
```

---

## 📱 移动端适配

所有功能在移动端也能正常使用：
- 懒加载按钮响应触摸
- 图片预览支持触摸关闭
- @用户功能支持触摸点击
- 缩略图在小屏幕上调整为 120x120

---

## ⚠️ 注意事项

1. **图片模糊**：默认模糊是为了防止不宜内容直接显示，需要点击才能看清
2. **加载性能**：每次加载 150 条消息，如果消息很多建议保持这个数量
3. **@用户**：仅支持 @单个用户名（不含空格的用户名）
4. **历史消息**：没有更多历史消息时按钮会自动隐藏

---

## 🐛 常见问题

**Q: 为什么图片显示模糊？**
A: 这是设计功能，防止不宜内容直接展示。点击图片可以查看清晰大图。

**Q: 如何 @多个用户？**
A: 可以在消息中输入多个 @用户名，每个都会高亮显示。

**Q: 加载更多按钮不显示？**
A: 说明已经加载了所有历史消息，没有更早的消息了。

**Q: 图片加载慢怎么办？**
A: 图片使用了 lazy loading，会延迟加载。可以稍等片刻。

---

## 📄 相关文件

- `src/services/chatService.js` - 消息加载服务
- `src/components/ChatWindow.vue` - 聊天窗口（懒加载）
- `src/components/MessageItem.vue` - 消息项（图片+@用户）
- `src/components/ChatInput.vue` - 输入框（@用户插入）
- `src/App.vue` - 主应用（事件处理）

---

**版本**: v2.0  
**更新时间**: 2026-02-27
